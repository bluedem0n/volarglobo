<?php

/**
 * ProveedorDescuento
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    hub-usmjesus
 * @subpackage model
 * @author     Jesus Salazar - usmjesus@gmail.com
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class ProveedorDescuento extends BaseProveedorDescuento
{
    
    
    public function __toString() {
        return $this->getNombre();
    }
    
    static public $comportamiento = array(
        0 => 'Ninguna',
        1 => 'Hora',
        2 => 'Minuto'
    );
    
    static public $tipo = array(
        1 => 'Servicio',
        2 => 'Producto',
        3 => 'Promociones'
    );
    
    
    
    public function getDescuentos(){
        $q = Doctrine_Query::create()
                ->from('ProveedorDescuento c')
                ->where('c.status=1')
                ->orderBy('c.fecha_activacion Desc');
        return $q->execute();
    }
    
    
     public function getDescuentosCcId($CcId){
        $q = Doctrine_Query::create()
                ->from('ProveedorDescuento c')
                ->leftJoin('c.Proveedor ctte On c.proveedor_id = ctte.id')
                ->where('ctte.centro_comercial_id=?', $CcId);
        return $q->execute();
    }
    
     public function getDescuentosCc(){
        $q = Doctrine_Query::create()
                ->select('cd.*,COUNT(cd.id) as total, cd.tipo as tipo, ctte.centro_comercial_id as centro_id')
                ->from('ProveedorDescuento cd')
                ->leftJoin('cd.Proveedor ctte ON cd.proveedor_id = ctte.id')
                ->where('cd.status=1')
                ->groupBy('cd.tipo')
                ->addGroupBy('ctte.centro_comercial_id');
        return $q->execute();
    }
    
    
    
    public function getDescuentosCtte($CtteId){
        $q = Doctrine_Query::create()
                ->from('ProveedorDescuento c')
                ->where('c.user_id=?', $CtteId);
        return $q->execute();
    }
    
    public function getDescuentosCtteId($CtteId){
        $q = Doctrine_Query::create()
                ->from('ProveedorDescuento c')
                ->where('c.proveedor_id=?', $CtteId);
        return $q->execute();
    }
    
    public function getDescuentoId($id){
        $q = Doctrine_Query::create()
                ->from('ProveedorDescuento c')
                ->where('c.id=?', $id);
        return $q->fetchOne();
    }
    
    
    public function getDescuentoSlug($id){
        $q = Doctrine_Query::create()
                ->from('ProveedorDescuento c')
                ->where('c.slug=?', $id);
        return $q->fetchOne();
    }
    
    public function getDescuentosCatId($id){
        $q = Doctrine_Query::create()
                ->from('ProveedorDescuento c')
                ->where('c.categoria_id=?', $id);
        return $q->execute();
    }
    
    
    
    
    
         public function getProveedorDescuentosPager(){
       $q = Doctrine_Query::create()
            -> from('ProveedorDescuento p')
            ->orderBy('p.nombre');
       return $q;
    }
      
    
     public function postSave($values){

         
           $proveedor_descuento = new ProveedorDescuento();
           $proveedor_descuento = $proveedor_descuento->getProveedorDescuentosPager()->execute();
           foreach ($proveedor_descuento as $tipo_restricion){
               sfContext::getInstance()->getUser()->setAttribute('proveedor_descuento_categoria'.$tipo_restricion->getId(),$tipo_restricion->getCategoria());
               sfContext::getInstance()->getUser()->setAttribute('proveedor_descuento_nombre'.$tipo_restricion->getId(),$tipo_restricion->getProveedor());
               sfContext::getInstance()->getUser()->setAttribute('proveedor_descuento'.$tipo_restricion->getId(),$tipo_restricion->getNombre());
               sfContext::getInstance()->getUser()->setAttribute('proveedor_descuento_precio'.$tipo_restricion->getId(),$tipo_restricion->getPrecio());
           }
         
    }
    
    
}
