<?php

/**
 * Proveedor
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    hub-usmjesus
 * @subpackage model
 * @author     Jesus Salazar - usmjesus@gmail.com
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class Proveedor extends BaseProveedor
{
    public function __toString() {
        return $this->getNombre();
    }
    


    
    public function  setFeriados($data) {
                $data = serialize($data);
                $this->_set('feriados', $data);
   }
      
      
      
     public function  getFeriados(){
             return unserialize($this->_get('feriados'));
            
      }
                
     public function getEmpresaCtteId($CtteId){
        $q = Doctrine_Query::create()
                ->from('Proveedor c')
                ->where('c.user_id=?', $CtteId);
        return $q->execute();
    }
    
    public function getCtteId($CtteId){
        $q = Doctrine_Query::create()
                ->from('Proveedor c')
                ->where('c.id=?', $CtteId);
        return $q->fetchOne();
    }
    
    public function getCtteSlug($CtteId){
        $q = Doctrine_Query::create()
                ->from('Proveedor c')
                ->where('c.slug=?', $CtteId);
        return $q->fetchOne();
    }
      
      
       public function getProveedores(){
        $q = Doctrine_Query::create()
                ->from('Proveedor c')
//                ->where('c.empresa_id=?', sfContext::getInstance()->getUser()->getAttribute('agente_user_empresa_id'))
                ->orderBy('c.nickname asc');
        return $q->execute();
    }
    
    public function getProveedoresUltimas(){
        $q = Doctrine_Query::create()
                ->from('Proveedor c')
//                ->where('c.empresa_id=?', sfContext::getInstance()->getUser()->getAttribute('agente_user_empresa_id'))
                ->orderBy('c.id desc');
        return $q->execute();
    }
    
    
    
    
     public function getProveedoresPager(){
       $q = Doctrine_Query::create()
            -> from('Proveedor p')
//            ->where('p.empresa_id=?', sfContext::getInstance()->getUser()->getAttribute('agente_user_empresa_id'))
            ->orderBy('p.nombre');
       return $q;
    }
    
       public function getProveedorId($id){
       $q = Doctrine_Query::create()
            -> from('Proveedor p')
            ->where('p.id=?', $id)
            ->orderBy('p.nombre');
       return $q->fetchOne();
    }
    
    
    public function getProveedoresSelect(){
       $q = Doctrine_Query::create()
            ->select("p.id, CONCAT(p.nombre,' RUC',p.rif) as nombre")
            -> from('Proveedor p')
//             ->where('p.empresa_id=?', sfContext::getInstance()->getUser()->getAttribute('agente_user_empresa_id'))
            ->orderBy('p.nombre');
       return $q;
    }
    
    public function getProveedorMarca(){
        $q = Doctrine_Query::create()
                ->from('Proveedor c')
//                ->where('c.empresa_id=?', sfContext::getInstance()->getUser()->getAttribute('agente_user_empresa_id'))
                ->orderBy('c.nickname asc');
        return $q;
    }
      
    
    public function getProveedoresTotal(){
       $q = Doctrine_Query::create()
            ->select(' COUNT(c.id) as cant')
            -> from('Proveedor c')
//            ->where('c.empresa_id = ?',sfContext::getInstance()->getUser()->getAttribute('agente_user_empresa_id'))
            ->groupBy('c.empresa_id');
       return $q->execute();
    }
    
      
}
