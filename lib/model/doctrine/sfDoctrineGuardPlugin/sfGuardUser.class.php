<?php

/**
 * sfGuardUser
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    cronos-doctrine
 * @subpackage model
 * @author     Your name here
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class sfGuardUser extends PluginsfGuardUser
{
    
   static public $sexo = array(
        1 => 'Hombre',
        2 => 'Mujer'

    );
   
   static public $is_active = array(
        0 => 'Inactivo',
        1 => 'Activo'

    );
    
   static public $edo_civil = array(
        0 => 'No Definido',
        1 => 'Casad@',
        2 => 'Viud@',
        3 => 'Soter@',
        4 => 'Divorciad@'
    );
   
   public function getProveedorId($id){
        $q = Doctrine_Query::create()
            -> from('sfGuardUser c')
            ->where('c.is_active = ?', '1')
            ->addWhere('c.id=?', $id);
       return $q->fetchOne();
       
    }
   
   public function getsfGuardUsersPager(){
       $q = Doctrine_Query::create()
            -> from('sfGuardUser p')
            ->where('p.empresa_id=?', sfContext::getInstance()->getUser()->getAttribute('agente_user_empresa_id'));
       return $q;
    }
   
     public function getAgentes(){
        $q = Doctrine_Query::create()
            -> from('sfGuardUser c')
            ->where('c.is_active = ?', '1')
            ->addWhere('c.empresa_id=?', sfContext::getInstance()->getUser()->getAttribute('agente_user_empresa_id'))
            ->leftJoin('c.sfGuardUserPermission s')
            ->addWhere('s.permission_id=3 or s.permission_id=2');
       return $q->execute();
       
    }
    public function getAgentesCC(){
        $q = Doctrine_Query::create()
            -> from('sfGuardUser c')
            ->where('c.is_active = ?', '1')
            ->addWhere('c.empresa_id=?', sfContext::getInstance()->getUser()->getAttribute('agente_user_empresa_id'))
            ->leftJoin('c.sfGuardUserPermission s')
            ->addWhere('s.permission_id=3');
       return $q->execute();
       
    }
    public function getAgente($id){
        $q = Doctrine_Query::create()
            -> from('sfGuardUser c')
            ->where('c.is_active = ?', '1')
            ->addWhere('c.empresa_id=?', sfContext::getInstance()->getUser()->getAttribute('agente_user_empresa_id'))
            ->leftJoin('c.sfGuardUserPermission s')
            ->addWhere("c.id=$id")
            ->addWhere('s.permission_id=3')
            ->orderBy('c.username');
       return $q->execute();
       
    }
    
    public function getOperador(){
        $q = Doctrine_Query::create()
            -> from('sfGuardUser c')
            ->where('c.is_active = ?', '1')
            ->addWhere('c.empresa_id=?', sfContext::getInstance()->getUser()->getAttribute('agente_user_empresa_id'))
            ->leftJoin('c.sfGuardUserPermission s')
            ->addWhere('s.permission_id=7');
       return $q;
       
    }
    
    public function getPersonal(){
         $q = Doctrine_Query::create()
            -> from('sfGuardUser c')
            ->addWhere('c.empresa_id=?', sfContext::getInstance()->getUser()->getAttribute('agente_user_empresa_id'));
       return $q->execute();
       
    }
    
    public function getPersonalAll($permi = 0){
         $q = Doctrine_Query::create()
            -> from('sfGuardUser c')
            ->addWhere('c.empresa_id=?', sfContext::getInstance()->getUser()->getAttribute('agente_user_empresa_id'))
            ->leftJoin('c.sfGuardUserPermission s on c.id = s.user_id');
            if($permi>0){
            $q->addWhere('s.permission_id='.$permi);
            }
       return $q->execute();
       
    }
    
    public function getGerenteCallcenter(){
        $q = Doctrine_Query::create()
            -> from('sfGuardUser c')
            ->where('c.is_active = ?', '1')
            ->addWhere('c.empresa_id=?', sfContext::getInstance()->getUser()->getAttribute('agente_user_empresa_id'))
            ->leftJoin('c.sfGuardUserPermission s')
            ->addWhere('s.permission_id=2');
       return $q->fetchOne();
    }
    
    
     public function getEmpleadosTotal(){
       $q = Doctrine_Query::create()
            ->select(' COUNT(c.id) as cant')
            -> from('sfGuardUser c')
            ->where('c.empresa_id = ?',sfContext::getInstance()->getUser()->getAttribute('agente_user_empresa_id'))
            ->groupBy('c.empresa_id');
       
       return $q->execute();
       
    }
    
    
}
