<?php

/**
 * CategoriaTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class CategoriaTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object CategoriaTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('Categoria');
    }
    
     public function getCategoriaServicio($tipo){
        $q = Doctrine_Query::create()
            -> from('Categoria c')
            ->where('c.status = ?', '1')
            ->addWhere('c.tipo_id = ?', $tipo)
            ->addWhere('padre IS NULL ')
            ->orderBy('orden ASC');
       return $q;
    }
    
    public function getCategoriaTipoLlamadaProgramada($usuario_id, $tipo){
        $llamadaProgramada = new LlamadaProgramada();
        $llamadaProgramada = $llamadaProgramada->getLlamadaProgramadasTodas($usuario_id);
        
        $q = Doctrine_Query::create()
            -> from('Categoria c')
            ->where('c.status = ?', '1');
            foreach ($llamadaProgramada as $llamadaPro){
                $q->addWhere('c.id != ?', $llamadaPro->getCategoriaId());
            }
            $q  ->addWhere('tipo_id = ?', $tipo)
                ->addWhere('padre IS NULL ')
                ->orderBy('orden ASC');
            
        
       return $q;
    }
    
    public  function getCategoriaPadreProducto($padre = NULL){
        $q = Doctrine_Query::create()
            -> from('Categoria c')
            ->where('c.status = ?', '1');
        $q->addWhere('c.tipo_id = ?', 1);
        if($padre){
            $q->addWhere('padre = ?', $padre);
        }
        else {
            $q->addWhere('padre IS NULL ');
        }
            $q->orderBy('orden ASC');
        return $q;
    }
    
    public  function getCategoriaPadreServicio($padre = NULL){
        $q = Doctrine_Query::create()
            -> from('Categoria c')
            ->where('c.status = ?', '1');
        $q->addWhere('c.tipo_id = ?', 2);
        if($padre){
            $q->addWhere('padre = ?', $padre);
        }
        else {
            $q->addWhere('padre IS NULL ');
        }
            $q->orderBy('orden ASC');
        return $q;
    }
}